@model  ISAT.Web.ViewModel.CustomerViewModel
@using X.PagedList.Mvc;
@using X.PagedList;
@using ISAT.Web.ViewModel;
@{
    ViewBag.Title = "IndexCustomer";
    CustomerCriteria filter = (CustomerCriteria)ViewBag.CurrentFilter;
}

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="text-center m-t-lg">
                @*@if (IsPost && ViewBag.Message != null)
                    {
                        <div class="alert alert-success alert-dismissable">
                            <button aria-hidden="true" data-dismiss="alert" class="close" type="button"></button>
                            @ViewBag.Message
                        </div>
                    }*@
                <h1>
                    Customer Data
                </h1>
                <!-- Filter Panel-->
                <table class="table" width="100%">
                    <tr>
                        <td>
                            <a id="btn_filterlist" class="btn btn-success" data-toggle="collapse" data-target="#filterlist_panel">FILTER LIST <span class="align-right"><i class="fa fa-angle-down"></i></span></a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <form id="filterForm" name="filterForm" action="IndexCustomer" method="post" accept-charset="utf-8">
                                <div id="filterlist_panel" class="panel-collapse collapse">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="form-group col-lg-2">
                                                <label class="control-label">First Name</label>
                                                <div>
                                                    <input type="text" name="FirstName" value="@Model.Criteria.FirstName" class="form-control input-sm">
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-2">
                                                <label class="control-label">Last Name</label>
                                                <div>
                                                    <input type="text" name="LastName" value="@Model.Criteria.LastName" class="form-control input-sm">
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-2">
                                                <label class="control-label">Email</label>
                                                <div>
                                                    <input type="text" name="Email" value="@Model.Criteria.Email" class="form-control input-sm">
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-2">
                                                <label class="control-label">Phone Number</label>
                                                <div>
                                                    <input type="text" name="CustNo" value="@Model.Criteria.CustNo" class="form-control input-sm">
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-2">
                                                <label class="control-label">Company Name</label>
                                                <div>
                                                    <input type="text" name="CompanyName" value="@Model.Criteria.CompanyName" class="form-control input-sm">
                                                </div>
                                            </div>
                                            @*<div class="form-group col-lg-2">
                                                <label class="control-label">Created Date</label>
                                                <div>
                                                    <input type="date" name="CreatedDate" value="@Model.Criteria.CreatedDate" class="form-control input-sm">
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-2">
                                                <label class="control-label">Created By</label>
                                                <div>
                                                    <input type="text" name="CreatedBy" value="@Model.Criteria.CreatedBy" class="form-control input-sm">
                                                </div>
                                            </div>*@
                                        </div>
                                    </div>

                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-xs-12 text-center">
                                                <button type="button" class="btn" onclick="resetFields(filterForm);">RESET</button>
                                                <button id="btnSubmit" type="submit" class="btn btn-primary">GO</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </td>
                    </tr>
                </table>
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <table>
                            <tr>
                                <td>
                                    <h5><button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="button" id="btnCreateTicket"><strong>Create Ticket</strong></button></h5>
                                </td>
                                <td>
                                    <h5><a class="btn btn-sm btn-primary pull-right m-t-n-xs" href="@Url.Action("ExportExcelCustomerData", "Customer", new { FormMethod.Post })">Export Excel</a></h5>
                                </td>
                            </tr>
                        </table>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <table class="table table-striped table-bordered table-hover dataTables-Customer">
                            <thead>
                                <tr>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Email</th>
                                    <th>Phone Number</th>
                                    <th>Company Name</th>
                                    <th>Created Date</th>
                                    <th>Created By</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.ListCustomer)
                                {
                                    <tr>
                                        <td><a href='@Url.Action("CustomerProfile","Customer", new { email = item.Email })'>@item.FirstName</a> </td>
                                        <td>@item.LastName</td>
                                        <td>@item.Email</td>
                                        <td>@item.CustNo</td>
                                        <td>@item.CompanyName</td>
                                        <td>@item.CreatedDate.ToString("dd MMM yyyy")</td>
                                        <td>@item.CreatedBy</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        @Html.PagedListPager((IPagedList)ViewBag.OnePageOfProducts, page => Url.Action("IndexCustomer", new { page }))
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
}

@section Scripts {
    @Scripts.Render("~/plugins/dataTables")

    <script type="text/javascript">
        $(document).ready(function () {
            $('.dataTables-Customer').DataTable({
                pageLength: 10,
                "paging": false,
                "info": false,
                dom: '<"html5buttons"B>lTfgitp'
            });

            $('#btnCreateTicket').click(function () {
                window.location.href = '@Url.Action("Index", "Ticketing")';
            });

        });

        function resetFields(filterForm) {
            $(':input', filterForm).each(function () {
                var type = this.type;
                var tag = this.tagName.toLowerCase();
                if (type == 'text' || type == 'password' || tag == 'textarea' || type == 'file')
                    this.value = "";
                else if (type == 'checkbox' || type == 'radio')
                    this.checked = false;
                else if (tag == 'select')
                    this.selectedIndex = 0;
            });
        }
    </script>
}